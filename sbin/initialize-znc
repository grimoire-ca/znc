#!/bin/bash -e

if [ ! -e /mnt/znc/data ]; then
  mkdir -p /mnt/znc/data

  mkdir -p /mnt/znc/data/configs
  cat > /mnt/znc/data/configs/znc.conf <<'CONFIG'
// WARNING
//
// Do NOT edit this file while ZNC is running!
// Use webadmin or *controlpanel instead.
//
// Altering this file by hand will forfeit all support.
//
// But if you feel risky, you might want to read help on /znc saveconfig and /znc rehash.
// Also check http://en.znc.in/wiki/Configuration

Version = 1.6.6
<Listener l>
	Port = 7000
	IPv4 = true
	IPv6 = true
	SSL = false
</Listener>
LoadModule = webadmin

<User admin>
	Pass       = sha256#fc4614ead1ac7cd68261f29c833929648e901afe5ee232f7224753ef89b08729#eb4tTEcvw)D(AUp9/H/l#
	Admin      = true
	Nick       = admin
	AltNick    = admin_
	Ident      = admin
	RealName   = Got ZNC?
	LoadModule = chansaver
	LoadModule = controlpanel
</User>
CONFIG
  touch /mnt/znc/data/znc.pem

  chown -R znc: /mnt/znc/data
  chmod 0770 /mnt/znc/data
fi

if [ ! -e /var/lib/znc ]; then
  ln -s /mnt/znc/data /var/lib/znc
fi
